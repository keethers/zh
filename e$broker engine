// E$ Broker Engine â€“ Exotica turns E$ into spendable assets
import { getESBalance, sendToWallet, triggerPurchase } from './walletUtils';

export async function convertEStoCash(userWallet, method = 'ETH', amount = 100) {
  const balance = await getESBalance(userWallet);
  if (balance < amount) {
    return `âŒ Insufficient E$: You have ${balance} E$, need ${amount}`;
  }

  const success = await sendToWallet(userWallet, method, amount);
  return success
    ? `âœ… Exotica sent ${amount} E$ worth to ${method}. Transaction complete.`
    : `âŒ Conversion failed. Check wallet or payment method.`;
}

export async function spendES(userWallet, vendor = 'Amazon', amount = 25, item = 'Gift Card') {
  const balance = await getESBalance(userWallet);
  if (balance < amount) {
    return `âŒ Not enough E$. You have ${balance}.`;
  }

  const success = await triggerPurchase(vendor, item, amount);
  return success
    ? `ðŸ›’ Exotica purchased ${item} from ${vendor} using ${amount} E$.`
    : `âŒ Purchase failed. Try again or change vendor.`;
}
